/*! bebella 2016-07-16 */
function view(a){return APP_URL+"/admin/"+a}function api_v1(a,b){return APP_URL+"/api/v1/"+a+"?api_token="+API_TOKEN}function attr(a,b){for(var c in b)"created_at"==c||"updated_at"==c?a[c]=new Date(b[c]):c.startsWith("has_")||c.startsWith("is_")||c.startsWith("used_for_")||"active"==c?a[c]=1==b[c]:a[c]=b[c]}var Bebella=angular.module("Bebella",["ui.router","datatables","angular-flot"]),APP_URL=$("#APP_URL").val(),API_TOKEN=$("#API_TOKEN").val();Bebella.run([function(){}]),Bebella.factory("Category",[function(){var a=new Function;return a}]),Bebella.factory("Channel",[function(){var a=new Function;return a}]),Bebella.factory("Product",[function(){var a=new Function;return a}]),Bebella.factory("ProductOption",[function(){var a=new Function;return a}]),Bebella.factory("Recipe",[function(){var a=function(){this.tags=new Array,this.steps=new Array,this.products=new Array,this.comments=new Array,this.related=new Array};return a}]),Bebella.factory("Store",[function(){var a=new Function;return a}]),Bebella.factory("User",[function(){var a=new Function;return a}]),Bebella.service("Breadcumb",[function(){var a=this;a.title="Teste",a.items=[]}]),Bebella.service("CurrentCategory",["Category",function(a){var b=this,c=new a;b.get=function(){return c},b.clear=function(){c=new a}}]),Bebella.service("CurrentChannel",["Channel",function(a){var b=this,c=new a;b.get=function(){return c},b.clear=function(){c=new a}}]),Bebella.service("CurrentProduct",["Product",function(a){var b=this,c=new a;b.get=function(){return c},b.clear=function(){c=new a}}]),Bebella.service("CurrentProductOption",["ProductOption",function(a){var b=this,c=new a;b.get=function(){return c},b.clear=function(){c=new a}}]),Bebella.service("CurrentRecipe",["Recipe",function(a){var b=this,c=new a;b.get=function(){return c},b.clear=function(){c=new a}}]),Bebella.service("CurrentStore",["Store",function(a){var b=this,c=new a;b.get=function(){return c},b.clear=function(){c=new a}}]),Bebella.service("CurrentUser",["User",function(a){var b=this,c=new a;b.get=function(){return c},b.clear=function(){c=new a}}]),Bebella.service("CategoryRepository",["$http","$q","Category",function(a,b,c){var d=this;d.find=function(d){var e=b.defer();return a.get(api_v1("category/find/"+d)).then(function(a){var b=new c;attr(b,a.data),e.resolve(b)},function(a){e.reject(a)}),e.promise},d.all=function(){var d=b.defer();return a.get(api_v1("category/all")).then(function(a){var b=_.map(a.data,function(a){var b=new c;return attr(b,a),b});d.resolve(b)},function(a){d.reject(a)}),d.promise},d.edit=function(c){var d=b.defer(),e=JSON.stringify(c);return a.post(api_v1("category/edit"),e).then(function(a){d.resolve(c)},function(a){d.reject(a)}),d.promise},d.save=function(c){var d=b.defer(),e=JSON.stringify(c);return a.post(api_v1("category/save"),e).then(function(a){c.id=a.data.id,d.resolve(c)},function(a){d.reject(a)}),d.promise}}]),Bebella.service("ChannelRepository",["$http","$q","Channel",function(a,b,c){var d=this;d.find=function(d){var e=b.defer();return a.get(api_v1("channel/find/"+d)).then(function(a){var b=new c;attr(b,a.data),e.resolve(b)},function(a){e.reject(a)}),e.promise},d.all=function(){var d=b.defer();return a.get(api_v1("channel/all")).then(function(a){var b=_.map(a.data,function(a){var b=new c;return attr(b,a),b});d.resolve(b)},function(a){d.reject(a)}),d.promise},d.edit=function(c){var d=b.defer(),e=JSON.stringify(c);return a.post(api_v1("channel/edit"),e).then(function(a){d.resolve(c)},function(a){d.reject(a)}),d.promise},d.save=function(c){var d=b.defer(),e=JSON.stringify(c);return a.post(api_v1("channel/save"),e).then(function(a){c.id=a.data.id,d.resolve(c)},function(a){d.reject(a)}),d.promise}}]),Bebella.service("ProductRepository",["$http","$q","Product",function(a,b,c){var d=this;d.find=function(d){var e=b.defer();return a.get(api_v1("product/find/"+d)).then(function(a){var b=new c;attr(b,a.data),e.resolve(b)},function(a){e.reject(a)}),e.promise},d.all=function(){var d=b.defer();return a.get(api_v1("product/all")).then(function(a){var b=_.map(a.data,function(a){var b=new c;return attr(b,a),b});d.resolve(b)},function(a){d.reject(a)}),d.promise},d.edit=function(c){var d=b.defer(),e=JSON.stringify(c);return a.post(api_v1("product/edit"),e).then(function(a){d.resolve(c)},function(a){d.reject(a)}),d.promise},d.save=function(c){var d=b.defer(),e=JSON.stringify(c);return a.post(api_v1("product/save"),e).then(function(a){c.id=a.data.id,d.resolve(c)},function(a){d.reject(a)}),d.promise}}]),Bebella.service("ProductOptionRepository",["$http","$q","ProductOption",function(a,b,c){var d=this;d.find=function(d){var e=b.defer();return a.get(api_v1("product_option/find/"+d)).then(function(a){var b=new c;attr(b,a.data),e.resolve(b)},function(a){e.reject(a)}),e.promise},d.getStoreUrl=function(c){var d=b.defer();return a.get(api_v1("product_option/getStoreUrl/"+c)).then(function(a){d.resolve(a.data)},function(a){d.reject(a)}),d.promise},d.all=function(){var d=b.defer();return a.get(api_v1("product_option/all")).then(function(a){var b=_.map(a.data,function(a){var b=new c;return attr(b,a),b});d.resolve(b)},function(a){d.reject(a)}),d.promise},d.edit=function(c){var d=b.defer(),e=JSON.stringify(c);return a.post(api_v1("product_option/edit"),e).then(function(a){d.resolve(c)},function(a){d.reject(a)}),d.promise},d.save=function(c){var d=b.defer(),e=JSON.stringify(c);return a.post(api_v1("product_option/save"),e).then(function(a){c.id=a.data.id,d.resolve(c)},function(a){d.reject(a)}),d.promise}}]),Bebella.service("RecipeRepository",["$http","$q","Recipe",function(a,b,c){var d=this;d.find=function(d){var e=b.defer();return a.get(api_v1("recipe/find/"+d)).then(function(a){var b=new c;attr(b,a.data),e.resolve(b)},function(a){e.reject(a)}),e.promise},d.all=function(){var d=b.defer();return a.get(api_v1("recipe/all")).then(function(a){var b=_.map(a.data,function(a){var b=new c;return attr(b,a),b});d.resolve(b)},function(a){d.reject(a)}),d.promise},d.edit=function(c){var d=b.defer(),e=JSON.stringify(c);return a.post(api_v1("recipe/edit"),e).then(function(a){d.resolve(c)},function(a){d.reject(a)}),d.promise},d.save=function(c){var d=b.defer(),e=JSON.stringify(c);return a.post(api_v1("recipe/save"),e).then(function(a){c.id=a.data.id,d.resolve(c)},function(a){d.reject(a)}),d.promise},d.sendForApproval=function(c){var d=b.defer(),e=JSON.stringify(c);return a.post(api_v1("recipe/sendForApproval"),e).then(function(a){c.id=a.data.id,d.resolve(c)},function(a){d.reject(a)}),d.promise}}]),Bebella.service("ReportRepository",["$http","$q",function(a,b){var c=this;c.redirectsByProductOption=function(c){var d=b.defer();return a.get(api_v1("report/redirectsByProductOption/"+c)).then(function(a){d.resolve(a.data)},function(a){d.reject(a)}),d.promise},c.clicksByProductOption=function(c){var d=b.defer();return a.get(api_v1("report/clicksByProductOption/"+c)).then(function(a){d.resolve(a.data)},function(a){d.reject(a)}),d.promise},c.viewsByProductOption=function(c){var d=b.defer();return a.get(api_v1("report/viewsByProductOption/"+c)).then(function(a){d.resolve(a.data)},function(a){d.reject(a)}),d.promise}}]),Bebella.service("StoreRepository",["$http","$q","Store",function(a,b,c){var d=this;d.find=function(d){var e=b.defer();return a.get(api_v1("store/find/"+d)).then(function(a){var b=new c;attr(b,a.data),e.resolve(b)},function(a){e.reject(a)}),e.promise},d.all=function(){var d=b.defer();return a.get(api_v1("store/all")).then(function(a){var b=_.map(a.data,function(a){var b=new c;return attr(b,a),b});d.resolve(b)},function(a){d.reject(a)}),d.promise},d.edit=function(c){var d=b.defer(),e=JSON.stringify(c);return a.post(api_v1("store/edit"),e).then(function(a){d.resolve(c)},function(a){d.reject(a)}),d.promise},d.save=function(c){var d=b.defer(),e=JSON.stringify(c);return a.post(api_v1("store/save"),e).then(function(a){c.id=a.data.id,d.resolve(c)},function(a){d.reject(a)}),d.promise}}]),Bebella.service("UserRepository",["$http","$q","User",function(a,b,c){var d=this;d.auth=function(){var d=b.defer();return a.get(APP_URL+"/auth/user").then(function(a){var b=new c;attr(b,a.data),d.resolve(b)},function(a){d.reject(a)}),d.promise},d.save=function(c){var d=b.defer(),e=JSON.stringify(c);return a.post(api_v1("user/save"),e).then(function(a){c.id=a.data.id,d.resolve(c)},function(a){d.reject(a)}),d.promise},d.all=function(){var d=b.defer();return a.get(api_v1("user/all")).then(function(a){var b=_.map(a.data,function(a){var b=new c;return attr(b,a),b});d.resolve(b)},function(a){d.reject(a)}),d.promise}}]),Bebella.controller("BreadcumbCtrl",["$scope","Breadcumb",function(a,b){a.breadcumb=b}]),Bebella.controller("CategoryEditCtrl",["$scope","Breadcumb","$stateParams","CategoryRepository",function(a,b,c,d){b.items=[{url:"home",text:"Dashboard"},{url:"category_detail({categoryId: "+c.categoryId+"})",text:"Categoria"},{text:"Formulário de Cadastro"}],a.edit=function(){d.edit(a.category).then(function(a){alert("Categoria editada com sucesso.")},function(a){alert("Erro ao criar esta categoria.")})},d.find(c.categoryId).then(function(c){a.category=c,b.title=c.name},function(a){alert("Houve um erro na obtenção dos dados desta categoria")})}]),Bebella.controller("CategoryListCtrl",["$scope","CategoryRepository","Breadcumb",function(a,b,c){c.title="Categorias",c.items=[{url:"home",text:"Dashboard"},{text:"Lista"}],b.all().then(function(b){a.categories=b},function(a){alert("Houve um erro na obtenção da lista de categorias")})}]),Bebella.controller("CategoryNewCtrl",["$scope","CurrentCategory","CategoryRepository","Breadcumb",function(a,b,c,d){d.title="Nova Categoria",d.items=[{url:"home",text:"Dashboard"},{text:"Formulário de Cadastro"}],a.category=b.get(),a.create=function(){c.save(a.category).then(function(a){alert("Categoria cadastrada com sucesso."),b.clear()},function(a){alert("Erro ao criar esta categoria.")})},a.clear=function(){b.clear(),a.category=b.get()}}]),Bebella.controller("ChannelListCtrl",["$scope","ChannelRepository",function(a,b){b.all().then(function(b){a.channels=b},function(a){alert("Houve um erro na obtenção da lista de canais")})}]),Bebella.controller("ChannelNewCtrl",["$scope","CurrentChannel","ChannelRepository",function(a,b,c){a.channel=b.get(),a.create=function(){c.save(a.channel).then(function(a){alert(a.id),alert("Canal cadastrado com sucesso.")},function(a){alert("Houve um erro no cadasto deste canal.")})},a.clear=function(){b.clear(),a.channel=b.get()}}]),Bebella.controller("ProductOptionDetailCtrl",["$scope","$stateParams","Breadcumb","ProductOptionRepository","ReportRepository",function(a,b,c,d,e){c.items=[{url:"home",text:"Dashboard"},{url:"product_option_list",text:"Lista"},{text:"Opção de Produto"}],a.viewClickDataset=[{color:"#fb2b67",label:"visualizações",shadowSize:1,data:[]},{color:"#ff6511",label:"cliques",shadowSize:1,data:[]}],a.redirectOptions={legend:{show:!0,container:"#chart-legends1"},series:{lines:{lineWidth:2}},xaxis:{mode:"time",timezone:"browser",position:"bottom",timeFormat:"%d/%m/%y"}},a.viewClickOptions={legend:{show:!0,container:"#chart-legends2"},series:{lines:{lineWidth:2}},xaxis:{mode:"time",timezone:"browser",position:"bottom",timeFormat:"%d/%m/%y"}},d.find(b.productOptionId).then(function(b){a.productOption=b,c.title=b.name},function(a){alert("Houve um erro na obtenção da lista de produtos")}),e.redirectsByProductOption(b.productOptionId).then(function(b){a.redirectDataset=[{color:"#fb2b67",label:"redirecionamentos",shadowSize:1,data:_.map(b,function(a){return[new Date(a.date),a.count]})}]},function(a){alert("Houve um erro na obtenção da lista de redirecionamentos")}),e.clicksByProductOption(b.productOptionId).then(function(a){},function(a){alert("Houve um erro na obtenção da lista de cliques")}),e.viewsByProductOption(b.productOptionId).then(function(b){a.viewClickDataset[0].data=_.map(b,function(a){return[new Date(a.date),a.count]})},function(a){alert("Houve um erro na obtenção da lista de visualizações")})}]),Bebella.controller("ProductOptionListCtrl",["$scope","ProductOptionRepository",function(a,b){b.all().then(function(b){a.product_options=b},function(a){alert("Houve um erro na obtenção da lista de opções de produto.")})}]),Bebella.controller("ProductOptionNewCtrl",["$scope","StoreRepository","ProductRepository","ProductOptionRepository","CurrentProductOption",function(a,b,c,d,e){a.product_option=e.get(),b.all().then(function(b){a.stores=b},function(a){alert("Houve um erro na obtenção da lista de lojas")}),c.all().then(function(b){a.products=b},function(a){alert("Houve um erro na obtenção da lista de lojas")}),a.create=function(){d.save(a.product_option).then(function(a){alert(a.id),alert("Opção de produto cadastrada com sucesso")},function(a){alert("Erro ao cadastrar opção de produto.")})},a.clear=function(){e.clear(),a.product_option=e.get()}}]),Bebella.controller("ProductEditCtrl",["$scope","$stateParams","ProductRepository","CategoryRepository",function(a,b,c,d){a.edit=function(){c.edit(a.product).then(function(a){alert("Produto editado com sucesso.")},function(a){alert("Erro ao criar este produto.")})},c.find(b.productId).then(function(b){a.product=b},function(a){alert("Houve um erro na obtenção dos dados deste produto")}),d.all().then(function(b){a.categories=b},function(a){alert("Houve um erro na obtenção da lista de categorias")})}]),Bebella.controller("ProductListCtrl",["$scope","ProductRepository",function(a,b){b.all().then(function(b){a.products=b},function(a){alert("Houve um erro na obtenção da lista de produtos.")})}]),Bebella.controller("ProductNewCtrl",["$scope","CurrentProduct","CategoryRepository","ProductRepository",function(a,b,c,d){a.product=b.get(),a.create=function(){d.save(a.product).then(function(a){alert(a.id),alert("Produto criado com sucesso.")},function(){alert("Houve um erro na criação do produto.")})},a.clear=function(){b.clear(),a.product=b.get()},c.all().then(function(b){a.categories=b},function(a){alert("Houve um erro na obtenção das lista de categorias")})}]),Bebella.controller("RecipeEditCtrl",["$scope","$stateParams","$timeout","RecipeRepository","ChannelRepository","ProductRepository",function(a,b,c,d,e,f){e.all().then(function(b){a.channels=b},function(a){alert("Houve um erro na obtenção da lista de canais")}),f.all().then(function(b){a.products=b},function(a){alert("Houve um erro na obtenção da lista de produtos")}),d.find(b.recipeId).then(function(b){a.recipe=b,console.log(b)},function(a){alert("Houve um erro na obtenção da receita.")}),a.edit=function(){d.edit(a.recipe).then(function(a){alert("Receita editada com sucesso.")},function(a){alert("Erro ao editar receita")})},a.newTag=function(){a.recipe.tags.push({})},a.removeTag=function(){a.recipe.tags.pop()},a.newStep=function(){a.recipe.steps.push({})},a.removeStep=function(){a.recipe.steps.pop()},a.newProduct=function(){a.recipe.products.push({})},a.removeProduct=function(){a.recipe.products.pop()}}]),Bebella.controller("RecipeListCtrl",["$scope","RecipeRepository",function(a,b){b.all().then(function(b){a.recipes=b},function(a){alert("Erro ao carregar lista de receitas")})}]),Bebella.controller("RecipeNewCtrl",["$scope","ChannelRepository","RecipeRepository","ProductRepository","CurrentRecipe",function(a,b,c,d,e){a.recipe=e.get(),b.all().then(function(b){a.channels=b},function(a){alert("Houve um erro na obtenção da lista de canais")}),d.all().then(function(b){a.products=b},function(a){alert("Houve um erro na obtenção da lista de produtos")}),a.create=function(){c.save(a.recipe).then(function(a){alert(a.id),alert("Nova receita criada com sucesso.")},function(a){alert("Houve um erro na criação desta receita.")})},a.clear=function(){e.clear(),a.recipe=e.get()},a.newTag=function(){a.recipe.tags.push({})},a.removeTag=function(){a.recipe.tags.pop()},a.newStep=function(){a.recipe.steps.push({})},a.removeStep=function(){a.recipe.steps.pop()},a.newProduct=function(){a.recipe.products.push({})},a.removeProduct=function(){a.recipe.products.pop()}}]),Bebella.controller("StoreListCtrl",["$scope","StoreRepository",function(a,b){b.all().then(function(b){a.stores=b},function(a){alert("Erro ao obter a lista de lojas.")})}]),Bebella.controller("StoreNewCtrl",["$scope","CurrentStore","StoreRepository",function(a,b,c){a.store=b.get(),a.create=function(){c.save(a.store).then(function(a){alert(a.id),alert("Loja cadastrada com sucesso")},function(a){alert("Houve um erro ao cadastrar a loja.")})},a.clear=function(){b.clear(),a.store=b.get()}}]),Bebella.controller("UserListCtrl",["$scope","UserRepository","Breadcumb",function(a,b,c){c.title="Usuários",c.items=[{url:"home",text:"Dashboard"},{text:"Lista"}],b.all().then(function(b){a.users=b},function(a){alert("Erro ao obter lista de usuários")})}]),Bebella.controller("UserNewCtrl",["$scope","Breadcumb","CurrentUser","UserRepository",function(a,b,c,d){b.title="Novo Usuário",b.items=[{url:"home",text:"Dashboard"},{text:"Formulário de Cadastro"}],a.user=c.get(),a.create=function(){d.save(a.user).then(function(a){alert(a.id),alert("Novo Usuário criado com sucesso")},function(a){alert("Erro ao criar novo usuário")})},a.clear=function(){c.clear(),a.user=c.get()}}]),Bebella.directive("fileread",[function(){return{scope:{fileread:"="},link:function(a,b,c){b.bind("change",function(b){var c=new FileReader;c.onload=function(b){a.$apply(function(){a.fileread=b.target.result})},c.readAsDataURL(b.target.files[0])})}}}]),Bebella.config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("user_new",{url:"/user/new",views:{MainContent:{templateUrl:view("user/new")}}}).state("user_list",{url:"/user/list",views:{MainContent:{templateUrl:view("user/list")}}}).state("recipe_new",{url:"/recipe/new",views:{MainContent:{templateUrl:view("recipe/new")}}}).state("recipe_edit",{url:"/recipe/{recipeId}/edit",views:{MainContent:{templateUrl:view("recipe/edit")}}}).state("recipe_list",{url:"/recipe/list",views:{MainContent:{templateUrl:view("recipe/list")}}}).state("category_new",{url:"/category/new",views:{MainContent:{templateUrl:view("category/new")}}}).state("category_list",{url:"/category/list",views:{MainContent:{templateUrl:view("category/list")}}}).state("category_edit",{url:"/category/edit/{categoryId}",views:{MainContent:{templateUrl:view("category/edit")}}}).state("store_new",{url:"/store/new",views:{MainContent:{templateUrl:view("store/new")}}}).state("store_list",{url:"/store/list",views:{MainContent:{templateUrl:view("store/list")}}}).state("channel_new",{url:"/channel/new",views:{MainContent:{templateUrl:view("channel/new")}}}).state("channel_list",{url:"/channel/list",views:{MainContent:{templateUrl:view("channel/list")}}}).state("product_new",{url:"/product/new",views:{MainContent:{templateUrl:view("product/new")}}}).state("product_list",{url:"/product/list",views:{MainContent:{templateUrl:view("product/list")}}}).state("product_edit",{url:"/product/edit/{productId}",views:{MainContent:{templateUrl:view("product/edit")}}}).state("product_option_new",{url:"/product_option/new",views:{MainContent:{templateUrl:view("product_option/new")}}}).state("product_option_list",{url:"/product_option/list",views:{MainContent:{templateUrl:view("product_option/list")}}}).state("product_option_detail",{url:"/product_option/{productOptionId}/detail",views:{MainContent:{templateUrl:view("product_option/detail")}}}).state("home",{url:"/",views:{MainContent:{templateUrl:view("dashboard")}}})}]);